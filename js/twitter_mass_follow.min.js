function Button(t,i){var e=this;e.$el=t,e.count=0,e.$title=t.find(".tmf-btn__title"),e.$subtitle=t.find(".tmf-btn__subtitle"),e.action=new BulkAction(i),e.$el.on("click",function(){e.$el.addClass("tmf-btn--active"),e.$title.text(e.count),e.action.paused?(e.action.proceed(),e.$subtitle.text("Click to pause")):(e.action.pause(),e.$subtitle.text("Click to continue"))})}function Profile(t){this.$el=$(".ProfileCard:eq("+t+")"),this.isLoaded()&&(this.$btn=this.$el.find(".user-actions-follow-button"),this.id=this.$el.data("user-id")+"-")}function BulkAction(t){this.callback=t,this.paused=!0}$.fn.isPresent=function(){return this.length>0};var USER_ID=$("#user-dropdown").find("[data-user-id]").data("user-id"),Record={storage:chrome.storage.local,key:USER_ID.toString(),get:function(t){var i=this;this.storage.get(this.key,function(e){i.result=e,t.call()})},set:function(){this.storage.set(this.result)},add:function(t){this.result[this.key]?this.result[this.key]+=t:this.result[this.key]=t,this.set()},includes:function(t){return this.result[this.key]?this.result[this.key].includes(t):!1}},tmf={init:function(){var t=this;t.$el=$("<div>").addClass("tmf animated").appendTo("body")},toggle:function(){var t=this;this.$el.removeClass("flipInY flipOutY tmf--active"),$(".ProfileCard").length>10?t.$el.load(chrome.extension.getURL("html/actions.html"),{},function(){$(".tmf-btn").on("click",function(){t.$el.addClass("tmf--active")}),t.followBtn=new Button($(".tmf-btn--follow"),function(){this.follow()}),t.unfollowBtn=new Button($(".tmf-btn--unfollow"),function(){this.unfollow()}),t.$el.addClass("flipInY"),$("#tmf_without_exception").on("change",function(){t.withoutException=this.checked,this.checked?(t.followBtn.$subtitle.text("without exception"),t.unfollowBtn.$subtitle.text("without exception")):(t.followBtn.$subtitle.text("who have never been unfollowed"),t.unfollowBtn.$subtitle.text("who do not follow you"))})}):this.$el.addClass("flipOutY")},withoutException:!1};$.extend(Button.prototype,{incrementCount:function(){this.count++,this.$title.text(this.count)}}),$.extend(Profile.prototype,{isLoaded:function(){return this.$el.isPresent()},isFollowing:function(){return this.$el.find(".FollowStatus").isPresent()},isNotFollowing:function(){return!this.isFollowing()},isFollowable:function(){return this.$btn.children(".follow-text").is(":visible")},isFollowed:function(){return this.$btn.children(".following-text").is(":visible")},follow:function(){this.isFollowable()&&(tmf.withoutException||!Record.includes(this.id)?(this.click(),tmf.followBtn.incrementCount()):this.log("warn","Already unfollowed once"))},unfollow:function(){(tmf.withoutException&&this.isFollowed()||this.isNotFollowing()&&this.isFollowed())&&(this.click(),tmf.unfollowBtn.incrementCount(),Record.add(this.id))},click:function(){this.log("success",'Clicked on "'+this.$btn.children(":visible").text().trim()+'"'),this.$btn.click(),this.clicked=!0},log:function(t,i){$("<div>").addClass("tmf-log").addClass("tmf-log--"+t).text(i).insertBefore(this.$el.find(".ProfileCard-bio"))}}),$.extend(BulkAction.prototype,{nth:0,loadAttempts:0,_loadProfiles:function(){this.loadAttempts<10&&(this.last.$btn.focus(),this.loadAttempts++,this._sleep(700))},_sleep:function(t){var i=this;setTimeout(function(){i.run()},t)},run:function(){if(!this.paused){var t=new Profile(this.nth);t.isLoaded()?(this.loadAttempts=0,this.callback.call(t),this.last=t,this.nth++,t.clicked?this._sleep(100):this.run()):this._loadProfiles()}},pause:function(){this.paused=!0},proceed:function(){this.paused=!1,this.run()}}),Record.get(function(){tmf.init(),tmf.toggle()});var observer=new MutationObserver(function(t){t.forEach(function(t){tmf.toggle()})});observer.observe(document.querySelector("head > title"),{subtree:!0,characterData:!0,childList:!0});